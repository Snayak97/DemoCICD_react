// pipeline {
//     agent any
//     environment {
//         COMPOSE_FILE = 'docker-compose.yml'
//         SONAR_HOME   = tool 'sonar'
//         GIT_URL      = "https://github.com/Snayak97/DemoCICD_react.git"
//         GIT_BRANCH   = "main"
//         VERSION      = "v1.0.0"
//         APP_NAME     = "demo_reactapp"
//     }

//     options {
//         timestamps()
//         buildDiscarder(logRotator(numToKeepStr: '10'))
//         disableConcurrentBuilds()
//         skipDefaultCheckout(true)
//         ansiColor('xterm')
//     }

//     stages {
//         stage('Cleanup') {
//             steps {
//                 script {
//                     echo "========== CLEANUP START =========="

//                     try {
//                         deleteDir()
//                         echo "Workspace cleaned"

//                         sh '''
//                           which docker || { echo "Docker not installed"; exit 1; }
//                           docker compose down -v || echo "No running containers"
//                         '''
//                     } catch (err) {
//                         echo "Cleanup failed: ${err}"
//                         error("Stopping pipeline — cleanup stage failed.")
//                     }

//                     echo "========== CLEANUP END =========="
//                 }
//             }
//         }
//         stage('Checkout Code') {
//             steps {
//                 script {
//                     echo "========== CHECKOUT START =========="

//                     retry(3) {
//                         try {
//                             checkout([
//                                 $class: 'GitSCM',
//                                 branches: [[name: "*/${GIT_BRANCH}"]],
//                                 userRemoteConfigs: [[url: "${GIT_URL}"]]
//                             ])
//                             echo "Checkout successful"
//                         } catch (err) {
//                             echo "Git checkout failed: ${err}"
//                             echo "Retrying in 3 seconds..."
//                             sleep 3
//                             throw err
//                         }
//                     }

//                     echo "========== CHECKOUT END =========="
//                 }
//             }
//         }
//         stage('Debug Workspace') {
//             steps {
//                 script {
//                     echo "========== WORKSPACE DEBUG START =========="

//                     try {
//                         sh '''
//                           echo "---- Directory ----"
//                           pwd

//                           echo "---- Files ----"
//                           ls -la

//                           echo "---- Checking Required Files ----"
//                           cat index.html || echo "index.html not found"
//                           echo "---- Git Status ----"
//                           git status || echo "Not a git repo"
//                         '''
//                         echo "Workspace validation passed"
//                     } catch (err) {
//                         echo "Workspace validation failed: ${err}"
//                         error("Stopping pipeline — required files missing.")
//                     }

//                     echo "========== WORKSPACE DEBUG END =========="
//                 }
//             }
//         }
//         stage('Install Dependencies') {
//             steps {
//         script {
//             echo "========== INSTALL DEPENDENCIES START =========="

//             try {
//                 sh '''
//                   which node || { echo "Node.js not installed"; exit 1; }
//                   node -v
//                   npm -v
//                 '''
//                 sh '''
//                   npm ci --prefer-offline
//                 '''

//                 echo "Dependencies installed successfully (using npm ci --prefer-offline)"
//             } catch (err) {
//                 echo "Dependency installation failed: ${err}"
//                 error("Stopping pipeline — Install Dependencies failed.")
//             }

//             echo "========== INSTALL DEPENDENCIES END =========="
//         }
//     }
//         }
//         stage('Build React App') {
//             steps {
//         script {
//             echo "========== BUILD START =========="

//             try {
//                 sh '''
//                   echo "Building React app..."
//                   npm run build
//                 '''
//                 echo "React app built successfully"
//             } catch (err) {
//                 echo "Build failed: ${err}"
//                 error("Stopping pipeline — Build React App failed.")
//             }

//             echo "========== BUILD END =========="
//         }
//     }
//         }
//         stage('SonarQube Analysis') {
//             steps {
//                 echo "Starting SonarQube Analysis..."
//                 script {
//                     retry(2) {
//                         withSonarQubeEnv("sonar") {
//                             try {
//                                 sh """
//                                     ${SONAR_HOME}/bin/sonar-scanner \
//                                     -Dsonar.projectKey=${APP_NAME} \
//                                     -Dsonar.projectName=${APP_NAME} \
//                                     -Dsonar.sources=. 
//                                 """
//                                 echo "SonarQube analysis completed successfully."
//                             } catch (Exception err) {
//                                 echo "SonarQube analysis failed: ${err}"
//                                 error "SonarQube stage failed"
//                             }
//                         }
//                     }
//                 }
//             }
//         }
//         stage('Quality Gate Check') {
//             steps {
//                 timeout(time: 3, unit: 'MINUTES') {
//                     script {
//                         try {
//                             def qg = waitForQualityGate(abortPipeline: false)

//                             echo "Quality Gate Status: ${qg.status}"

//                             if (qg.status != 'OK') {
//                                 echo "Quality Gate FAILED — Status: ${qg.status}"
//                                 error "Pipeline stopped because Quality Gate failed: ${qg.status}"
//                             }

//                             echo "Quality Gate PASSED successfully."

//                         } catch (Exception err) {
//                             echo "Error while checking Quality Gate: ${err}"
//                             error "Quality Gate Check failed unexpectedly."
//                         }
//                     }
//                 }
//             }
//         }
       
//         stage('Docker Login') {
//             steps {
//                 script {
//             echo "========== DOCKER LOGIN START =========="

//             try {
//                 withCredentials([usernamePassword(credentialsId: 'dockerhub-creds',
//                                                  usernameVariable: 'DOCKERHUB_USER',
//                                                  passwordVariable: 'DOCKERHUB_PASS')]) {

//                     sh """
//                         echo "Checking Docker installation..."
//                         which docker >/dev/null 2>&1 || { echo 'Docker not installed'; exit 1; }

//                         echo "Logging into Docker Hub..."
//                         echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin
//                     """

//                     echo "Docker login successful."
//                 }
//             } catch (err) {
//                 echo "Docker login failed: ${err}"
//                 error("Stopping pipeline — Docker Login stage failed.")
//             }

//             echo "========== DOCKER LOGIN END =========="
//         }
//             }
//         }


    
//     stage('Docker Build') {
//         steps {
//         script {
//             echo "========== DOCKER BUILD START =========="

//             try {
//                 def DOCKERHUB_IMAGE = "snayak97/soumya1"

//                 sh """
//                     echo "Checking Docker installation..."
//                     which docker >/dev/null 2>&1 || { echo 'Docker is not installed'; exit 1; }
//                     test -f ${COMPOSE_FILE} || { echo 'Missing compose file'; exit 1; }

//                     echo "Building Docker Image using docker-compose..."
//                     docker compose -f ${COMPOSE_FILE} build --no-cache

//                     echo "Tagging image for DockerHub..."
//                     docker tag demoreact-app:latest ${DOCKERHUB_IMAGE}:${VERSION}

//                     echo "Cleaning unused images..."
//                     docker image prune -f
//                 """
//             } catch (err) {
//                 echo "Docker build failed: ${err}"
//                 error("Stopping pipeline — Docker Build stage failed.")
//             }

//             echo "========== DOCKER BUILD END =========="
//         }
//     }
//     }

//     stage('Check Repo Exists') {
//         steps {
//         script {
//             def repo = "snayak97/soumya1"

//             echo "Checking if Docker Hub repo exists: ${repo}"

//             def response = sh(script: """
//                 curl -s -o /dev/null -w "%{http_code}" https://hub.docker.com/v2/repositories/${repo}/
//             """, returnStdout: true).trim()

//             if (response != "200") {
//                 error "DockerHub repository ${repo} does NOT exist. Create it manually."
//             } else {
//                 echo "DockerHub repository exists. Proceeding..."
//             }
//         }
//     }
//     }
//     stage('Docker Push') {
//     steps {
//         script {
//             def fullImage = "snayak97/soumya1:${VERSION}"

//             echo "Pushing image: ${fullImage}"

//             try {
//                 sh "docker push ${fullImage}"
//             } catch (err) {
//                 error("Docker push failed: ${err}")
//             }

//             echo "Docker push successful."
//         }
//     }
// }






//     }
    
//     post {
//     always {
//         echo "Cleaning up..."
//         sh "docker logout || true"
//     }
//     success {
//         echo "Pipeline completed successfully."
//     }
//     failure {
//         echo "Pipeline failed — Check logs."
//     }
// }

    
// }


// // example?
// pipeline {
//     agent any

//     environment {
//         GIT_URL = "https://github.com/Snayak97/DemoCICD_react.git"
//         GIT_BRANCH = "main"
//         DOCKERHUB_REPO = "snayak97/soumya1"
//         APP_NAME = "demo_reactapp"

//         DEV_COMPOSE_FILE = "docker-compose.dev.yml"
//         STAGING_COMPOSE_FILE = "docker-compose.stage.yml"
//         PROD_COMPOSE_FILE = "docker-compose.prod.yml"

//         DEV_SERVER = "ubuntu@ec2-54-83-66-74.compute-1.amazonaws.com"
//         STAGING_SERVER = "ubuntu@ec2-3-95-18-173.compute-1.amazonaws.com"
//         PROD_SERVER = "ubuntu@ec2-44-220-158-39.compute-1.amazonaws.com"

//         PREVIOUS_VERSION = ""
//         DEPLOYMENT_STATUS = "PENDING"
//         SKIP_DOCKER_BUILD = "false"
//         VERSION = ""
//     }

//     options {
//         timestamps()
//         buildDiscarder(logRotator(numToKeepStr: '10'))
//         disableConcurrentBuilds()
//         skipDefaultCheckout(true)
//         ansiColor('xterm')
//     }

//     parameters {
//         choice(name: 'VERSION_TYPE', choices: ['PATCH','MINOR','MAJOR'], description: 'Select version increment type')
//         choice(name: 'DEPLOY_TO', choices: ['development', 'staging', 'production', 'all'], description: 'Select deployment target')
//         booleanParam(name: 'SKIP_TESTS', defaultValue: false, description: 'Skip tests')
//         booleanParam(name: 'FORCE_DEPLOY', defaultValue: false, description: 'Force deployment even if quality gate fails')
//     }

//     stages {
// //         stage('Fetch Latest Version') {
// //     steps {
// //         script {
// //             // Fetch all tags from Docker Hub
// //             sh """
// //                 curl -s "https://hub.docker.com/v2/repositories/${DOCKERHUB_REPO}/tags/?ordering=last_updated" > docker_tags.json
// //             """

// //             // Get the latest semver tag
// //             PREVIOUS_VERSION = sh(
// //                 script: 'jq -r \'.results[] | select(.name|test("^v[0-9]+\\\\.[0-9]+\\\\.[0-9]+$")) | .name\' docker_tags.json | sort | tail -n1',
// //                 returnStdout: true
// //             ).trim()

            
// //             echo "Previous version: ${PREVIOUS_VERSION}"
          

// //         }
// //     }
// // }
//             stage('Fetch Latest Version') {
//     steps {
//         script {
//             try {
//                 echo "Fetching Docker tags for ${DOCKERHUB_REPO}..."

//                 // Fetch all tags from Docker Hub with error handling
//                 def curlStatus = sh(
//                     script: """
//                         curl -s -f "https://hub.docker.com/v2/repositories/${DOCKERHUB_REPO}/tags/?ordering=last_updated" -o docker_tags.json
//                         echo \$?
//                     """,
//                     returnStdout: true
//                 ).trim()

//                 if (curlStatus != "0") {
//                     error "Failed to fetch tags from Docker Hub. curl exited with status: ${curlStatus}"
//                 }

//                 // Get the latest semver tag from Docker Hub
//                 def previousVersion = sh(
//                     script: 'jq -r \'.results[] | select(.name|test("^v[0-9]+\\\\.[0-9]+\\\\.[0-9]+$")) | .name\' docker_tags.json | sort | tail -n1',
//                     returnStdout: true
//                 ).trim()

//                 if (!previousVersion) {
//                     previousVersion = "v0.0.0"
//                     echo "No previous version found. Starting from ${previousVersion}"
//                 } else {
//                     echo "Previous version: ${previousVersion}"
//                 }

//                 // Increment version dynamically
//                 def version = incrementVersion(previousVersion, params.VERSION_TYPE)
//                 echo "Next version: ${version}"

//                 // Abort pipeline if the new version is same as previous
//                 if (previousVersion == version) {
//                     error "Pipeline aborted: New version (${version}) is same as previous version (${previousVersion})"
//                 }

//                 // Assign to environment variables if needed for later stages
//                 env.PREVIOUS_VERSION = previousVersion
//                 env.VERSION = version

//             } catch (Exception e) {
//                 // Catch any unexpected errors and fail gracefully
//                 error "Stage 'Fetch Latest Version' failed: ${e.getMessage()}"
//             }
//         }
//     }
// }



//     }

//     post {
//         always {
//             echo "Cleaning up post-build..."
//             sh "docker logout || true"
//         }
//         success {
//             echo "Pipeline completed successfully!"
//         }
//         failure {
//             echo "Pipeline failed. Check logs for details."
//         }
//     }
// }

// // Define function at the bottom outside the pipeline
// def incrementVersion(String currentVersion, String type) {
//     def parts = currentVersion.replace("v", "").split("\\.")
//     def major = parts[0].toInteger()
//     def minor = parts[1].toInteger()
//     def patch = parts[2].toInteger()

//     if (type == 'PATCH') {
//         patch++
//     } else if (type == 'MINOR') {
//         minor++
//         patch = 0
//     } else if (type == 'MAJOR') {
//         major++
//         minor = 0
//         patch = 0
//     }

//     return "v${major}.${minor}.${patch}"
// }



// pipeline {
//     agent any
//     environment {
//         COMPOSE_FILE = 'docker-compose.yml'
        
//         SONAR_HOME   = tool 'sonar'
        
//         GIT_URL      = "https://github.com/Snayak97/DemoCICD_react.git"
//         GIT_BRANCH   = "main"
//         VERSION      = ""
        
//         APP_NAME     = "demo_reactapp"
//         DOCKERHUB_REPO  = "snayak97/soumya1"
        
//         DEV_PORT            = "5174"
//         STAGING_PORT        = "5175"
//         PROD_PORT           = "80"
        
//         DEV_CONTAINER       = "${APP_NAME}-dev"
//         STAGING_CONTAINER   = "${APP_NAME}-staging"
//         PROD_CONTAINER      = "${APP_NAME}-prod"
        
//         DEV_SERVER      = "ubuntu@ec2-54-83-66-74.compute-1.amazonaws.com"
//         STAGING_SERVER  = "ubuntu@ec2-3-95-18-173.compute-1.amazonaws.com"
//         PROD_SERVER     = "ubuntu@ec2-44-220-158-39.compute-1.amazonaws.com"
        
//         PREVIOUS_VERSION    = ""
//         DEPLOYMENT_STATUS   = "PENDING"
//     }
    
    
//     options {
//         timestamps()
//         buildDiscarder(logRotator(numToKeepStr: '10'))
//         disableConcurrentBuilds()
//         skipDefaultCheckout(true)
//         ansiColor('xterm')
//     }
//     parameters {
//         choice(
//             name: 'DEPLOY_TO',
//             choices: ['development', 'staging', 'production', 'all'],
//             description: 'Select deployment target'
//         )
//         booleanParam(
//             name: 'SKIP_TESTS',
//             defaultValue: false,
//             description: 'Skip tests (not recommended for prod)'
//         )
//         booleanParam(
//             name: 'FORCE_DEPLOY',
//             defaultValue: false,
//             description: 'Force deployment even if quality gate fails'
//         )
//     }

//     stages {
//         stage('Initialize Pipeline') {
//             steps {
//                 script {
                    
//                     try {
//                         PREVIOUS_VERSION = sh(
//                             script: "docker images ${DOCKERHUB_REPO} --format '{{.Tag}}' | head -1",
//                             returnStdout: true
//                         ).trim()
//                         echo " Previous version detected: ${PREVIOUS_VERSION}"
//                     } catch (Exception e) {
//                         echo " No previous version found"
//                         PREVIOUS_VERSION = "none"
//                     }
//                 }
//             }
//         }
//         stage('Cleanup Workspace') {
//             steps {
//                 script {
//                     echo "========== CLEANUP START =========="

//                     try {
//                         deleteDir()
//                         echo "Workspace cleaned"

//                         sh '''
//                           which docker || { echo "Docker not installed"; exit 1; }
//                           docker compose down -v || echo "No running containers"
//                         '''
//                     } catch (err) {
//                         echo "Cleanup failed: ${err}"
//                         error("Stopping pipeline — cleanup stage failed.")
//                     }

//                     echo "========== CLEANUP END =========="
//                 }
//             }
//         }
//         stage('Checkout Code') {
//             steps {
//                 script {
//                     echo "========== CHECKOUT START =========="

//                     retry(3) {
//                         try {
//                             checkout([
//                                 $class: 'GitSCM',
//                                 branches: [[name: "*/${GIT_BRANCH}"]],
//                                 userRemoteConfigs: [[url: "${GIT_URL}"]]
//                             ])
//                             echo "Checkout successful"
                            
//                         } catch (err) {
//                             echo "Git checkout failed: ${err}"
//                             echo "Retrying in 3 seconds..."
//                             sleep 3
//                             throw err
//                         }
//                     }


//                     echo "========== CHECKOUT END =========="
//                 }
//             }
//         }
//         stage('Set Version') {
//             steps {
//                 script {
//             // Get latest short commit hash
//             def gitHash = sh(script: "git rev-parse --short HEAD", returnStdout: true).trim()
//             env.VERSION = "${env.BUILD_NUMBER}-${gitHash}"
//             echo "VERSION set to: ${env.VERSION}"
//             }
//             }
//         }

//         stage('Debug Workspace') {
//             steps {
//                 script {
//                     echo "========== WORKSPACE DEBUG START =========="

//                     try {
//                         sh '''
//                           echo "---- Directory ----"
//                           pwd

//                           echo "---- Files ----"
//                           ls -la

//                           echo "---- Checking Required Files ----"
//                           cat index.html || echo "index.html not found"
//                           echo "---- Git Status ----"
//                           git status || echo "Not a git repo"
//                         '''
//                         echo "Workspace validation passed"
//                     } catch (err) {
//                         echo "Workspace validation failed: ${err}"
//                         error("Stopping pipeline — required files missing.")
//                     }

//                     echo "========== WORKSPACE DEBUG END =========="
//                 }
//             }
//         }
//         stage('Install Dependencies') {
//             steps {
//             script {
//             echo "========== INSTALL DEPENDENCIES START =========="

//             try {
//                 sh '''
//                   which node || { echo "Node.js not installed"; exit 1; }
//                   node -v
//                   npm -v
//                 '''
//                 sh '''
//                   npm ci --prefer-offline
//                 '''

//                 echo "Dependencies installed successfully (using npm ci --prefer-offline)"
//             } catch (err) {
//                 echo "Dependency installation failed: ${err}"
//                 error("Stopping pipeline — Install Dependencies failed.")
//             }

//             echo "========== INSTALL DEPENDENCIES END =========="
//             }
//     }
//         }
//         stage("unit test"){
//             steps{
//                 echo "unit test running"
//             }
//         }
//          stage('Build React App') {
//                 steps {
//             script {
//             echo "========== BUILD START =========="

//             try {
//                 sh '''
//                   echo "Building React app..."
//                   npm run build
//                 '''
//                 echo "React app built successfully"
//             } catch (err) {
//                 echo "Build failed: ${err}"
//                 error("Stopping pipeline — Build React App failed.")
//             }

//             echo "========== BUILD END =========="
//                 }
//             }
//          }
        

//         stage('Docker Login') {
//             steps {
//                 script {
//             echo "========== DOCKER LOGIN START =========="
//             try {
//                 withCredentials([usernamePassword(credentialsId: 'dockerhub-creds',
//                                                  usernameVariable: 'DOCKERHUB_USER',
//                                                  passwordVariable: 'DOCKERHUB_PASS')]) {
//                     sh '''
//                         which docker >/dev/null 2>&1 || { echo "Docker not installed"; exit 1; }
//                         echo "Logging into Docker Hub..."
//                         echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin
//                         docker info | grep Username
//                     '''
//                 }
//                 echo "Docker login successful."
//             } catch (err) {
//                 echo "Docker login failed: ${err}"
//                 error("Stopping pipeline — Docker Login stage failed.")
//             }
//             echo "========== DOCKER LOGIN END =========="
//                 }
//             }
//         }

//         stage('Check Docker Image Existence') {
//             steps {
//                 script {
//             echo "========== CHECK DOCKER IMAGE START =========="

//             try {
//                 if (!env.VERSION) {
//                     error("VERSION is not set. Cannot check Docker image existence.")
//                 }

//                 withCredentials([
//                     usernamePassword(
//                         credentialsId: 'dockerhub-creds',
//                         usernameVariable: 'DOCKERHUB_USER',
//                         passwordVariable: 'DOCKERHUB_PASS'
//                     )
//                 ]) {

//                     def response = sh(
//                         script: """
//                             TOKEN=\$(curl -s -H "Content-Type: application/json" \
//                                 -X POST -d '{"username":"$DOCKERHUB_USER","password":"$DOCKERHUB_PASS"}' \
//                                 https://hub.docker.com/v2/users/login/ | jq -r .token)

//                             curl -s -H "Authorization: JWT \$TOKEN" \
//                                 https://hub.docker.com/v2/repositories/${env.DOCKERHUB_REPO}/tags/${env.VERSION}/ \
//                                 | jq -r .name
//                         """,
//                         returnStdout: true
//                     ).trim()

//                     if (response == env.VERSION) {
//                         echo "Image already exists on DockerHub: ${env.DOCKERHUB_REPO}:${env.VERSION}"
//                         env.SKIP_DOCKER_BUILD = "true"
//                     } else {
//                         echo "Image does NOT exist. Will build."
//                         env.SKIP_DOCKER_BUILD = "false"
//                     }
//                 }

//             } catch (err) {
//                 echo "Error checking Docker image: ${err}"
//                 echo "Proceeding with image build."
//                 env.SKIP_DOCKER_BUILD = "false"
//             }

//             echo "========== CHECK DOCKER IMAGE END =========="
//             }
//             }
//         }


//         // stage('Docker Build') {
//         //     steps {
//         //         script {
//         //     echo "========== DOCKER BUILD START =========="
//         //     try {
//         //         sh """
//         //             which docker >/dev/null 2>&1 || { echo 'Docker is not installed'; exit 1; }

//         //             echo "Building Docker image using docker-compose..."
//         //             VERSION="${env.VERSION}" \
//         //             DOCKERHUB_REPO="${env.DOCKERHUB_REPO}" \
//         //             docker compose -f ${env.COMPOSE_FILE} build --no-cache

//         //             echo "Tagging image for DockerHub..."
//         //             docker tag ${env.DOCKERHUB_REPO}:${env.VERSION} ${env.DOCKERHUB_REPO}:${env.VERSION}

//         //             echo "Cleaning unused images..."
//         //             docker image prune -f
//         //         """
//         //     } catch (err) {
//         //         echo "Docker build failed: ${err}"
//         //         error("Stopping pipeline — Docker Build stage failed.")
//         //     }
//         //     echo "========== DOCKER BUILD END =========="
//         // }
//     }
// }

    





//     }
    
// }







// stage('Fetch Previous Version') {
//     steps {
//         script {
//             echo "Fetching previous version..."
//             sh '''
//                 curl -s "https://hub.docker.com/v2/repositories/${DOCKERHUB_REPO}/tags/?ordering=last_updated" > docker_tags.json
//             '''
//             def PREVIOUS_VERSION = sh(
//                 script: "jq -r '(.results[0].name // \"NONE\")' docker_tags.json",
//                 returnStdout: true
//             ).trim()

//             echo "Detected previous version: ${PREVIOUS_VERSION}"
//         }
//     }
// }























// // pipeline {
// //     agent any
// //     environment {
// //         COMPOSE_FILE = 'docker-compose.yml'
        
// //         SONAR_HOME = tool 'sonar'
       
// //         GIT_URL = "https://github.com/Snayak97/DemoCICD_react.git"
// //         GIT_BRANCH = "main"
// //         VERSION = "v1.${BUILD_NUMBER}"
       
// //         APP_NAME = "demo_reactapp"
// //         DOCKERHUB_REPO = "snayak97/soumya1"
       
// //         DEV_PORT = "5174"
// //         STAGING_PORT = "5175"
// //         PROD_PORT = "80"
       
// //         DEV_CONTAINER = "${APP_NAME}-dev"
// //         STAGING_CONTAINER = "${APP_NAME}-staging"
// //         PROD_CONTAINER = "${APP_NAME}-prod"
       
// //         DEV_SERVER = "ubuntu@ec2-54-83-66-74.compute-1.amazonaws.com"
// //         STAGING_SERVER = "ubuntu@ec2-3-95-18-173.compute-1.amazonaws.com"
// //         PROD_SERVER = "ubuntu@ec2-44-220-158-39.compute-1.amazonaws.com"
       
// //         PREVIOUS_VERSION = ""
// //         DEPLOYMENT_STATUS = "PENDING"
// //         SKIP_DOCKER_BUILD = "false"
// //     }
   
// //     options {
// //         timestamps()
// //         buildDiscarder(logRotator(numToKeepStr: '10'))
// //         disableConcurrentBuilds()
// //         skipDefaultCheckout(true)
// //         ansiColor('xterm')
// //     }
// //     parameters {
// //         choice(
// //             name: 'DEPLOY_TO',
// //             choices: ['development', 'staging', 'production', 'all'],
// //             description: 'Select deployment target'
// //         )
// //         booleanParam(
// //             name: 'SKIP_TESTS',
// //             defaultValue: false,
// //             description: 'Skip tests (not recommended for prod)'
// //         )
// //         booleanParam(
// //             name: 'FORCE_DEPLOY',
// //             defaultValue: false,
// //             description: 'Force deployment even if quality gate fails'
// //         )
// //     }
// //     stages {
// //         stage('Initialize Pipeline') {
// //             steps {
// //                 script {
                   
// //                     try {
// //                         PREVIOUS_VERSION = sh(
// //                             script: "docker images ${DOCKERHUB_REPO} --format '{{.Tag}}' | head -1",
// //                             returnStdout: true
// //                         ).trim()
// //                         echo " Previous version detected: ${PREVIOUS_VERSION}"
// //                     } catch (Exception e) {
// //                         echo " No previous version found"
// //                         PREVIOUS_VERSION = "none"
// //                     }
// //                 }
// //             }
// //         }
// //         stage('Cleanup Workspace') {
// //             steps {
// //                 script {
// //                     echo "========== CLEANUP START =========="
// //                     try {
// //                         deleteDir()
// //                         echo "Workspace cleaned"
// //                         sh '''
// //                           which docker || { echo "Docker not installed"; exit 1; }
// //                           docker compose down -v || echo "No running containers"
// //                         '''
// //                     } catch (err) {
// //                         echo "Cleanup failed: ${err}"
// //                         error("Stopping pipeline — cleanup stage failed.")
// //                     }
// //                     echo "========== CLEANUP END =========="
// //                 }
// //             }
// //         }
// //         stage('Checkout Code') {
// //             steps {
// //                 script {
// //                     echo "========== CHECKOUT START =========="
// //                     retry(3) {
// //                         try {
// //                             checkout([
// //                                 $class: 'GitSCM',
// //                                 branches: [[name: "*/${GIT_BRANCH}"]],
// //                                 userRemoteConfigs: [[url: "${GIT_URL}"]]
// //                             ])
// //                             echo "Checkout successful"
                           
// //                         } catch (err) {
// //                             echo "Git checkout failed: ${err}"
// //                             echo "Retrying in 3 seconds..."
// //                             sleep 3
// //                             throw err
// //                         }
// //                     }
// //                     if (env.GIT_COMMIT) {
// //                         env.VERSION = "${BUILD_NUMBER}-${env.GIT_COMMIT.take(7)}"
// //                         echo "✅ Dynamic VERSION created: ${env.VERSION}"
// //                     } else {
// //                         echo "⚠️  Using simple version: ${env.VERSION}"
// //                     }
                    
// //                     echo "========== CHECKOUT END =========="
// //                     echo "Git Commit: ${env.GIT_COMMIT ?: 'N/A'}"
// //                     echo "Final Version: ${env.VERSION}"
// //                     echo "========== CHECKOUT END =========="
// //                 }
// //             }
// //         }
       

       





// //         // stage('Debug Workspace') {
// //         //     steps {
// //         //         script {
// //         //             echo "========== WORKSPACE DEBUG START =========="
// //         //             try {
// //         //                 sh '''
// //         //                   echo "---- Directory ----"
// //         //                   pwd
// //         //                   echo "---- Files ----"
// //         //                   ls -la
// //         //                   echo "---- Checking Required Files ----"
// //         //                   cat index.html || echo "index.html not found"
// //         //                   echo "---- Git Status ----"
// //         //                   git status || echo "Not a git repo"
// //         //                 '''
// //         //                 echo "Workspace validation passed"
// //         //             } catch (err) {
// //         //                 echo "Workspace validation failed: ${err}"
// //         //                 error("Stopping pipeline — required files missing.")
// //         //             }
// //         //             echo "========== WORKSPACE DEBUG END =========="
// //         //         }
// //         //     }
// //         // }
// //         // stage('Install Dependencies') {
// //         //     steps {
// //         //         script {
// //         //             echo "========== INSTALL DEPENDENCIES START =========="
// //         //             try {
// //         //                 sh '''
// //         //                   which node || { echo "Node.js not installed"; exit 1; }
// //         //                   node -v
// //         //                   npm -v
// //         //                 '''
// //         //                 sh '''
// //         //                   npm ci --prefer-offline
// //         //                 '''
// //         //                 echo "Dependencies installed successfully (using npm ci --prefer-offline)"
// //         //             } catch (err) {
// //         //                 echo "Dependency installation failed: ${err}"
// //         //                 error("Stopping pipeline — Install Dependencies failed.")
// //         //             }
// //         //             echo "========== INSTALL DEPENDENCIES END =========="
// //         //         }
// //         //     }
// //         // }
// //         // stage("unit test"){
// //         //     steps{
// //         //         echo "unit test running"
// //         //     }
// //         // }
// //         // stage('Build React App') {
// //         //     steps {
// //         //         script {
// //         //             echo "========== BUILD START =========="
// //         //             try {
// //         //                 sh '''
// //         //                   echo "Building React app..."
// //         //                   npm run build
// //         //                 '''
// //         //                 echo "React app built successfully"
// //         //             } catch (err) {
// //         //                 echo "Build failed: ${err}"
// //         //                 error("Stopping pipeline — Build React App failed.")
// //         //             }
// //         //             echo "========== BUILD END =========="
// //         //         }
// //         //     }
// //         // }
       
// //         // stage('Docker Login') {
// //         //     steps {
// //         //         script {
// //         //             echo "========== DOCKER LOGIN START =========="
// //         //             try {
// //         //                 withCredentials([usernamePassword(credentialsId: 'dockerhub-creds',
// //         //                                          usernameVariable: 'DOCKERHUB_USER',
// //         //                                          passwordVariable: 'DOCKERHUB_PASS')]) {
// //         //                     sh '''
// //         //                         which docker >/dev/null 2>&1 || { echo "Docker not installed"; exit 1; }
// //         //                         echo "Logging into Docker Hub..."
// //         //                         echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin
// //         //                         docker info | grep Username
// //         //                     '''
// //         //                 }
// //         //                 echo "Docker login successful."
// //         //             } catch (err) {
// //         //                 echo "Docker login failed: ${err}"
// //         //                 error("Stopping pipeline — Docker Login stage failed.")
// //         //             }
// //         //             echo "========== DOCKER LOGIN END =========="
// //         //         }
// //         //     }
// //         // }
// //         // stage('Check Docker Image Existence') {
// //         //     steps {
// //         //         script {
// //         //             echo "========== CHECK DOCKER IMAGE START =========="
// //         //             try {
// //         //                 if (!env.VERSION) {
// //         //                     error("VERSION is not set. Cannot check Docker image existence.")
// //         //                 }
// //         //                 withCredentials([
// //         //                     usernamePassword(
// //         //                         credentialsId: 'dockerhub-creds',
// //         //                         usernameVariable: 'DOCKERHUB_USER',
// //         //                         passwordVariable: 'DOCKERHUB_PASS'
// //         //                     )
// //         //                 ]) {
// //         //                     def response = sh(
// //         //                         script: """
// //         //                             TOKEN=\$(curl -s -H "Content-Type: application/json" \
// //         //                                 -X POST -d '{"username":"$DOCKERHUB_USER","password":"$DOCKERHUB_PASS"}' \
// //         //                                 https://hub.docker.com/v2/users/login/ | jq -r .token)
// //         //                             curl -s -H "Authorization: JWT \$TOKEN" \
// //         //                                 https://hub.docker.com/v2/repositories/${env.DOCKERHUB_REPO}/tags/${env.VERSION}/ \
// //         //                                 | jq -r .name
// //         //                         """,
// //         //                         returnStdout: true
// //         //                     ).trim()
// //         //                     if (response == env.VERSION) {
// //         //                         echo "Image already exists on DockerHub: ${env.DOCKERHUB_REPO}:${env.VERSION}"
// //         //                         env.SKIP_DOCKER_BUILD = "true"
// //         //                     } else {
// //         //                         echo "Image does NOT exist. Will build."
// //         //                         env.SKIP_DOCKER_BUILD = "false"
// //         //                     }
// //         //                 }
// //         //             } catch (err) {
// //         //                 echo "Error checking Docker image: ${err}"
// //         //                 echo "Proceeding with image build."
// //         //                 env.SKIP_DOCKER_BUILD = "false"
// //         //             }
// //         //             echo "========== CHECK DOCKER IMAGE END =========="
// //         //         }
// //         //     }
// //         // }
// //         // stage('Docker Build') {
// //         //     steps {
// //         //         script {
// //         //             if (env.SKIP_DOCKER_BUILD != "true") {
// //         //                 // Set container name and host port based on DEPLOY_TO
// //         //                 def containerName = "${APP_NAME}-container"
// //         //                 def hostPort = "80"
// //         //                 if (params.DEPLOY_TO == 'development') {
// //         //                     containerName = "${APP_NAME}-dev"
// //         //                     hostPort = DEV_PORT
// //         //                 } else if (params.DEPLOY_TO == 'staging') {
// //         //                     containerName = "${APP_NAME}-staging"
// //         //                     hostPort = STAGING_PORT
// //         //                 } else if (params.DEPLOY_TO == 'production') {
// //         //                     containerName = "${APP_NAME}-prod"
// //         //                     hostPort = PROD_PORT
// //         //                 }
// //         //                 sh """
// //         //                     export VERSION=${VERSION}
// //         //                     export DOCKERHUB_REPO=${DOCKERHUB_REPO}
// //         //                     export CONTAINER_NAME=${containerName}
// //         //                     export HOST_PORT=${hostPort}
// //         //                     docker compose -f ${COMPOSE_FILE} build --no-cache
// //         //                     docker image prune -f
// //         //                 """
// //         //                 echo "Docker image built successfully"
// //         //             } else {
// //         //                 echo "Skipping Docker build"
// //         //             }
// //         //         }
// //         //     }
// //         //     }  
// //     }  
       
// //     post {
// //         always {
// //             sh "docker logout || true"
// //             archiveArtifacts artifacts: '**/dist/**', allowEmptyArchive: true
// //         }
// //         success {
// //             echo "Pipeline completed successfully!"
// //         }
// //         failure {
// //             echo "Pipeline failed - check logs"
// //         }
// //     }
// // }   // ← pipeline closing brace was missing





// examp1
pipeline {
    agent any

    environment {
        GIT_URL = "https://github.com/Snayak97/DemoCICD_react.git"
        GIT_BRANCH = "main"
        DOCKERHUB_REPO = "snayak97/soumya1"
        APP_NAME = "demo_reactapp"

        DEV_COMPOSE_FILE = "docker-compose.dev.yml"
        STAGING_COMPOSE_FILE = "docker-compose.stage.yml"
        PROD_COMPOSE_FILE = "docker-compose.prod.yml"

        DEV_SERVER = "ubuntu@ec2-54-83-66-74.compute-1.amazonaws.com"
        STAGING_SERVER = "ubuntu@ec2-3-95-18-173.compute-1.amazonaws.com"
        PROD_SERVER = "ubuntu@ec2-44-220-158-39.compute-1.amazonaws.com"

        PREVIOUS_VERSION = ""
        DEPLOYMENT_STATUS = "PENDING"
        SKIP_DOCKER_BUILD = "false"
        VERSION = ""
    }

    options {
        timestamps()
        buildDiscarder(logRotator(numToKeepStr: '10'))
        disableConcurrentBuilds()
        skipDefaultCheckout(true)
        ansiColor('xterm')
    }

    parameters {
        choice(name: 'VERSION_TYPE', choices: ['PATCH','MINOR','MAJOR'], description: 'Select version increment type')
        choice(name: 'DEPLOY_TO', choices: ['development', 'staging', 'production', 'all'], description: 'Select deployment target')
        booleanParam(name: 'SKIP_TESTS', defaultValue: false, description: 'Skip tests')
        booleanParam(name: 'FORCE_DEPLOY', defaultValue: false, description: 'Force deployment even if quality gate fails')
    }

    stages {

        stage('Fetch Latest Version') {
            steps {
                script {
                    try {
                        echo "Fetching Docker tags for ${DOCKERHUB_REPO}..."

                        def curlStatus = sh(
                            script: """
                                curl -s -f "https://hub.docker.com/v2/repositories/${DOCKERHUB_REPO}/tags/?ordering=last_updated" -o docker_tags.json
                                echo \$?
                            """,
                            returnStdout: true
                        ).trim()

                        if (curlStatus != "0") {
                            error "Failed to fetch tags from Docker Hub. curl exited with status: ${curlStatus}"
                        }

                        def previousVersion = sh(
                            script: 'jq -r \'.results[] | select(.name|test("^v[0-9]+\\\\.[0-9]+\\\\.[0-9]+$")) | .name\' docker_tags.json | sort | tail -n1',
                            returnStdout: true
                        ).trim()

                        if (!previousVersion) {
                            previousVersion = "v0.0.0"
                            echo "No previous version found. Starting from ${previousVersion}"
                        } else {
                            echo "Previous version: ${previousVersion}"
                        }

                        def version = incrementVersion(previousVersion, params.VERSION_TYPE)
                        echo "Next version: ${version}"

                        if (previousVersion == version) {
                            error "Pipeline aborted: New version (${version}) is same as previous version (${previousVersion})"
                        }

                        env.PREVIOUS_VERSION = previousVersion
                        env.VERSION = version

                    } catch (Exception e) {
                        error "Stage 'Fetch Latest Version' failed: ${e.getMessage()}"
                    }
                }
            }
        }

        // stage('Cleanup Workspace') {
        //     steps {
        //         script {
        //             echo "========== CLEANUP START =========="
        //             try {
        //                 deleteDir()
        //                 echo "Workspace cleaned"

        //                 sh '''
        //                   which docker || { echo "Docker not installed"; exit 1; }
        //                   docker compose down -v || echo "No running containers"
        //                 '''
        //             } catch (err) {
        //                 echo "Cleanup failed: ${err}"
        //                 error("Stopping pipeline — cleanup stage failed.")
        //             }
        //             echo "========== CLEANUP END =========="
        //         }
        //     }
        // }

        // stage('Checkout Code') {
        //     steps {
        //         script {
        //             echo "========== CHECKOUT START =========="
        //             retry(3) {
        //                 try {
        //                     checkout([
        //                         $class: 'GitSCM',
        //                         branches: [[name: "*/${GIT_BRANCH}"]],
        //                         userRemoteConfigs: [[url: "${GIT_URL}"]]
        //                     ])
        //                     echo "Checkout successful"
        //                 } catch (err) {
        //                     echo "Git checkout failed: ${err}"
        //                     echo "Retrying in 3 seconds..."
        //                     sleep 3
        //                     throw err
        //                 }
        //             }
        //             echo "========== CHECKOUT END =========="
        //         }
        //     }
        // }

        // stage('Debug Workspace') {
        //     steps {
        //         script {
        //             echo "========== WORKSPACE DEBUG START =========="
        //             try {
        //                 sh '''
        //                   echo "---- Current Directory ----"
        //                   pwd
        //                   echo "---- Files in Workspace ----"
        //                   ls -la
        //                 '''

        //                 def requiredFiles = [
        //                     "Dockerfile",
        //                     env.DEV_COMPOSE_FILE,
        //                     env.STAGING_COMPOSE_FILE,
        //                     env.PROD_COMPOSE_FILE,
        //                     "Jenkinsfile"
        //                 ]

        //                 def missingFiles = []
        //                 for (file in requiredFiles) {
        //                     if (!fileExists(file)) {
        //                         missingFiles << file
        //                     } else {
        //                         echo "Found required file: ${file}"
        //                     }
        //                 }

        //                 if (missingFiles.size() > 0) {
        //                     error("Pipeline aborted: Missing required file(s): ${missingFiles.join(', ')}")
        //                 }

        //                 echo "Workspace validation passed: All required files are present"
        //             } catch (err) {
        //                 echo "Workspace validation failed: ${err}"
        //                 error("Stopping pipeline — required files missing or workspace check failed.")
        //             }
        //             echo "========== WORKSPACE DEBUG END =========="
        //         }
        //     }
        // }

        // stage('Install Dependencies') {
        //     steps {
        //         script {
        //             echo "========== INSTALL DEPENDENCIES START =========="
        //             try {
        //                 sh '''
        //                   which node || { echo "Node.js not installed"; exit 1; }
        //                   node -v
        //                   npm -v
        //                 '''
        //                 sh '''
        //                   npm ci --prefer-offline
        //                 '''
        //                 echo "Dependencies installed successfully (using npm ci --prefer-offline)"
        //             } catch (err) {
        //                 echo "Dependency installation failed: ${err}"
        //                 error("Stopping pipeline — Install Dependencies failed.")
        //             }
        //             echo "========== INSTALL DEPENDENCIES END =========="
        //         }
        //     }
        // }

        // stage('Build React App') {
        //     steps {
        //         script {
        //             echo "========== BUILD START =========="
        //             try {
        //                 sh '''
        //                   echo "Building React app..."
        //                   npm run build
        //                 '''
        //                 echo "React app built successfully"
        //             } catch (err) {
        //                 echo "Build failed: ${err}"
        //                 error("Stopping pipeline — Build React App failed.")
        //             }
        //             echo "========== BUILD END =========="
        //         }
        //     }
        // }

        // stage('Docker Login') {
        //     steps {
        //         script {
        //             echo "========== DOCKER LOGIN START =========="
        //             try {
        //                 withCredentials([usernamePassword(credentialsId: 'dockerhub-creds',
        //                                                  usernameVariable: 'DOCKERHUB_USER',
        //                                                  passwordVariable: 'DOCKERHUB_PASS')]) {
        //                     sh '''
        //                         which docker >/dev/null 2>&1 || { echo "Docker not installed"; exit 1; }
        //                         echo "Logging into Docker Hub..."
        //                         echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin
        //                         docker info | grep Username
        //                     '''
        //                 }
        //                 echo "Docker login successful."
        //             } catch (err) {
        //                 echo "Docker login failed: ${err}"
        //                 error("Stopping pipeline — Docker Login stage failed.")
        //             }
        //             echo "========== DOCKER LOGIN END =========="
        //         }
        //     }
        // }
        stage("unit test"){
            steps{
                echo "Version: ${env.VERSION}"
                echo " P_ ver: ${env.PREVIOUS_VERSION}"
            }
        }
        // stage('Check Docker Image Existence') {
        //     steps {
        //         script {
        //     echo "========== CHECK DOCKER IMAGE START =========="

        //     try {
        //         if (!env.VERSION) {
        //             error("VERSION is not set. Cannot check Docker image existence.")
        //         }

        //         withCredentials([
        //             usernamePassword(
        //                 credentialsId: 'dockerhub-creds',
        //                 usernameVariable: 'DOCKERHUB_USER',
        //                 passwordVariable: 'DOCKERHUB_PASS'
        //             )
        //         ]) {

        //             def response = sh(
        //                 script: """
        //                     TOKEN=\$(curl -s -H "Content-Type: application/json" \
        //                         -X POST -d '{"username":"$DOCKERHUB_USER","password":"$DOCKERHUB_PASS"}' \
        //                         https://hub.docker.com/v2/users/login/ | jq -r .token)

        //                     curl -s -H "Authorization: JWT \$TOKEN" \
        //                         https://hub.docker.com/v2/repositories/${env.DOCKERHUB_REPO}/tags/${env.VERSION}/ \
        //                         | jq -r .name
        //                 """,
        //                 returnStdout: true
        //             ).trim()

        //             if (response == env.VERSION) {
        //                 echo "Image already exists on DockerHub: ${env.DOCKERHUB_REPO}:${env.VERSION}"
        //                 env.SKIP_DOCKER_BUILD = "true"
        //             } else {
        //                 echo "Image does NOT exist. Will build."
        //                 env.SKIP_DOCKER_BUILD = "false"
        //             }
        //         }

        //     } catch (err) {
        //         echo "Error checking Docker image: ${err}"
        //         echo "Proceeding with image build."
        //         env.SKIP_DOCKER_BUILD = "false"
        //     }

        //     echo "========== CHECK DOCKER IMAGE END =========="
        //     }
        //     }
        // }

    } // stages

    post {
        always {
            echo "Cleaning up post-build..."
            sh "docker logout || true"
        }
        success {
            echo "Pipeline completed successfully!"
        }
        failure {
            echo "Pipeline failed. Check logs for details."
        }
    }

} // pipeline

// Define function at the bottom outside the pipeline
def incrementVersion(String currentVersion, String type) {
    def parts = currentVersion.replace("v", "").split("\\.")
    def major = parts[0].toInteger()
    def minor = parts[1].toInteger()
    def patch = parts[2].toInteger()

    if (type == 'PATCH') {
        patch++
    } else if (type == 'MINOR') {
        minor++
        patch = 0
    } else if (type == 'MAJOR') {
        major++
        minor = 0
        patch = 0
    }

    return "v${major}.${minor}.${patch}"
}


// exmp2

        // stage('Cleanup Workspace') {
        //     steps {
        //         script {
        //             echo "========== CLEANUP START =========="
        //             try {
        //                 deleteDir()
        //                 echo "Workspace cleaned"

        //                 sh '''
        //                   which docker || { echo "Docker not installed"; exit 1; }
        //                   docker compose down -v || echo "No running containers"
        //                 '''
        //             } catch (err) {
        //                 echo "Cleanup failed: ${err}"
        //                 error("Stopping pipeline — cleanup stage failed.")
        //             }
        //             echo "========== CLEANUP END =========="
        //         }
        //     }
        // }

        // stage('Checkout Code') {
        //     steps {
        //         script {
        //             echo "========== CHECKOUT START =========="
        //             retry(3) {
        //                 try {
        //                     checkout([
        //                         $class: 'GitSCM',
        //                         branches: [[name: "*/${GIT_BRANCH}"]],
        //                         userRemoteConfigs: [[url: "${GIT_URL}"]]
        //                     ])
        //                     echo "Checkout successful"
        //                 } catch (err) {
        //                     echo "Git checkout failed: ${err}"
        //                     echo "Retrying in 3 seconds..."
        //                     sleep 3
        //                     throw err
        //                 }
        //             }
        //             echo "========== CHECKOUT END =========="
        //         }
        //     }
        // }

        // stage('Debug Workspace') {
        //     steps {
        //         script {
        //             echo "========== WORKSPACE DEBUG START =========="
        //             try {
        //                 sh '''
        //                   echo "---- Current Directory ----"
        //                   pwd
        //                   echo "---- Files in Workspace ----"
        //                   ls -la
        //                 '''

        //                 def requiredFiles = [
        //                     "Dockerfile",
        //                     env.DEV_COMPOSE_FILE,
        //                     env.STAGING_COMPOSE_FILE,
        //                     env.PROD_COMPOSE_FILE,
        //                     "Jenkinsfile"
        //                 ]

        //                 def missingFiles = []
        //                 for (file in requiredFiles) {
        //                     if (!fileExists(file)) {
        //                         missingFiles << file
        //                     } else {
        //                         echo "Found required file: ${file}"
        //                     }
        //                 }

        //                 if (missingFiles.size() > 0) {
        //                     error("Pipeline aborted: Missing required file(s): ${missingFiles.join(', ')}")
        //                 }

        //                 echo "Workspace validation passed: All required files are present"
        //             } catch (err) {
        //                 echo "Workspace validation failed: ${err}"
        //                 error("Stopping pipeline — required files missing or workspace check failed.")
        //             }
        //             echo "========== WORKSPACE DEBUG END =========="
        //         }
        //     }
        // }

        // stage('Install Dependencies') {
        //     steps {
        //         script {
        //             echo "========== INSTALL DEPENDENCIES START =========="
        //             try {
        //                 sh '''
        //                   which node || { echo "Node.js not installed"; exit 1; }
        //                   node -v
        //                   npm -v
        //                 '''
        //                 sh '''
        //                   npm ci --prefer-offline
        //                 '''
        //                 echo "Dependencies installed successfully (using npm ci --prefer-offline)"
        //             } catch (err) {
        //                 echo "Dependency installation failed: ${err}"
        //                 error("Stopping pipeline — Install Dependencies failed.")
        //             }
        //             echo "========== INSTALL DEPENDENCIES END =========="
        //         }
        //     }
        // }

        // stage('Build React App') {
        //     steps {
        //         script {
        //             echo "========== BUILD START =========="
        //             try {
        //                 sh '''
        //                   echo "Building React app..."
        //                   npm run build
        //                 '''
        //                 echo "React app built successfully"
        //             } catch (err) {
        //                 echo "Build failed: ${err}"
        //                 error("Stopping pipeline — Build React App failed.")
        //             }
        //             echo "========== BUILD END =========="
        //         }
        //     }
        // }

        // stage('Docker Login') {
        //     steps {
        //         script {
        //             echo "========== DOCKER LOGIN START =========="
        //             try {
        //                 withCredentials([usernamePassword(credentialsId: 'dockerhub-creds',
        //                                                  usernameVariable: 'DOCKERHUB_USER',
        //                                                  passwordVariable: 'DOCKERHUB_PASS')]) {
        //                     sh '''
        //                         which docker >/dev/null 2>&1 || { echo "Docker not installed"; exit 1; }
        //                         echo "Logging into Docker Hub..."
        //                         echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USER" --password-stdin
        //                         docker info | grep Username
        //                     '''
        //                 }
        //                 echo "Docker login successful."
        //             } catch (err) {
        //                 echo "Docker login failed: ${err}"
        //                 error("Stopping pipeline — Docker Login stage failed.")
        //             }
        //             echo "========== DOCKER LOGIN END =========="
        //         }
        //     }
        // }